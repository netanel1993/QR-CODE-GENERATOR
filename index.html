<!DOCTYPE html>
<html lang="he">
<head>
  <meta charset="UTF-8">
  <title>מחולל QR עם לוגו</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js">function downloadQR() {
  const qrCanvas = document.querySelector('#qrcode canvas');
  const logoInput = document.getElementById('logoInput');

  if (!qrCanvas) return alert("אנא צור קוד QR קודם");

  const canvas = document.createElement('canvas');
  canvas.width = qrCanvas.width;
  canvas.height = qrCanvas.height;
  const ctx = canvas.getContext('2d');

  // צייר את ה-QR
  ctx.drawImage(qrCanvas, 0, 0);

  // אם הועלה לוגו, שלב אותו במרכז
  if (logoInput.files && logoInput.files[0]) {
    const reader = new FileReader();
    reader.onload = function(e) {
      const img = new Image();
      img.onload = function() {
        const logoSize = 60;
        const x = (canvas.width - logoSize) / 2;
        const y = (canvas.height - logoSize) / 2;
        ctx.drawImage(img, x, y, logoSize, logoSize);

        const finalImage = canvas.toDataURL("image/png");
        const link = document.createElement('a');
        link.href = finalImage;
        link.download = 'qrcode_with_logo.png';
        link.click();
      };
      img.src = e.target.result;
    };
    reader.readAsDataURL(logoInput.files[0]);
  } else {
    // הורדה רגילה ללא לוגו
    const image = qrCanvas.toDataURL("image/png");
    const link = document.createElement('a');
    link.href = image;
    link.download = 'qrcode.png';
    link.click();
  }
}
</script>
  <style>
    body {
      direction: rtl;
      font-family: Arial, sans-serif;
      background: #f0f0f0;
      text-align: center;
      padding: 30px;
    }
    #qrcode {
      margin: 20px;
    }
    #upload-logo {
      display: none;
      margin-top: 20px;
    }
    .form-group {
      margin-bottom: 10px;
    }
  </style>
</head>
<body>
  <h1>מחולל QR עם לוגו</h1>

  <div class="form-group">
    <input type="text" id="text" placeholder="הכנס טקסט או קישור ל־QR" size="40">
  </div>

  <div class="form-group">
    <label>צבע QR: <input type="color" id="qrColor" value="#000000"></label>
    <label>צבע רקע: <input type="color" id="bgColor" value="#ffffff"></label>
  </div>

  <button onclick="generateQR()">צור קוד QR</button>
  <div id="qrcode"></div>
  <a id="pay-link" href="https://www.paypal.com/donate/?hosted_button_id=6TS7T3778TGEA&return=success.html" target="_blank">הוסף לוגו (₪9.90)</a>
  <br><br>
  <br><br>
  <button onclick="downloadQR()">הורד QR</button>

  <div id="upload-logo">
<input type="file" id="logoInput" accept="image/*">
    <p>העלאת לוגו תשלב אותו בתוך ה־QR</p>
  </div>

  <script>
    let qrCode;

    function generateQR() {
      const container = document.getElementById('qrcode');
      container.innerHTML = "";
      const text = document.getElementById('text').value;
      const color = document.getElementById('qrColor').value;
      const bgColor = document.getElementById('bgColor').value;
      if (text.trim() === "") return;

      localStorage.setItem('qr_text', text);
      localStorage.setItem('qr_color', color);
      localStorage.setItem('qr_bg', bgColor);

      qrCode = new QRCode(container, {
        text: text,
        width: 256,
        height: 256,
        colorDark: color,
        colorLight: bgColor
      });
    }

    function enableLogoUpload() {
      const user = localStorage.getItem("user");
      const paid = localStorage.getItem("paid") === "true";
      if (!user && !paid) {
        alert("יש להתחבר או לשלם לפני העלאת לוגו");
        return;
      }
      document.getElementById("upload-logo").style.display = "block";
    }

    // אם בוצע תשלום בעבר, נאפשר העלאת לוגו אוטומטית
    if (localStorage.getItem("paid") === "true") {
  enableLogoUpload();
  const payLink = document.getElementById("pay-link");
  if (payLink) payLink.style.display = "none";
}
  </script>
</body>
</html>
